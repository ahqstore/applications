---
import type { HomeData } from "@/utils/interfaces/home";
import type { GetImageResult } from "astro";
import { getImage, Image } from "astro:assets";

export interface Props {
  data: HomeData;
}

// Access props directly from Astro.props
const { data } = Astro.props;

const identMap: { [key: string]: string } = {
  w: "win32",
  a: "community",
};

const home = data.home;
const splash = data.splash;

console.log(splash); // This will log on the server during build

let splashHero: GetImageResult,
  splashSub: GetImageResult,
  splash3: GetImageResult,
  splash4: GetImageResult;

if (splash) {
  splashHero = await getImage({
    src: splash.hero.background,
    format: "webp",
    inferSize: true,
  });
}

// Import ChevronRight from lucide-react. This will be used in the client-side React component.
import { ChevronRight } from "lucide-react";
---

<script>
  // Find all buttons with the `alert` class on the page.
  const div = document.querySelector("#hero");

  div &&
    div.addEventListener("click", () => {
      const identMap: { [key: string]: string } = {
        w: "win32",
        a: "community",
      };

      const appId = div.getAttribute("data-app-id")!!;

      if (window.innerWidth < 768) {
        window.location.pathname = `/applications/view/${identMap[appId[0]]}/${appId.substring(2)}`;
      }
    });
</script>

<div class="px-2">
  {
    splash && (
      <>
        <div class="flex flex-col mt-3 lg:flex-row grow-0 w-full gap-5 animate">
          <div
            id="hero"
            class="hero"
            style={{
              background: `url("${splashHero!!.src}") center/cover`,
            }}
            data-app-id={splash.hero.appId}
          >
            <div />
            <div class="flex flex-col h-full">
              <h1>{splash.hero.title}</h1>
              <h2 class="!text-black dark:!text-white">
                {splash.hero.description}
              </h2>

              <div class="w-full">
                <a
                  href={`/applications/view/${identMap[splash.hero.appId[0]]}/${splash.hero.appId.substring(2)}`}
                >
                  {splash.hero.button}
                </a>
              </div>

              <h3 class="mt-auto mb-2 hidden md:block">{splash.hero.author}</h3>
            </div>
          </div>

          <div class="cards">
            <a
              href={`/applications/view/${identMap[splash.hero.appId[0]]}/${splash.hero.appId.substring(2)}`}
            >
              <div style={{ color: splash.subhero.color }}>
                {splash.subhero.title}
              </div>
              <Image
                src={splash.subhero.background}
                alt="Background"
                height="384"
                inferSize
                loading="eager"
              />
            </a>

            <a
              href={`/applications/view/${identMap[splash.hero.appId[0]]}/${splash.hero.appId.substring(2)}`}
            >
              <div style={{ color: splash.third.color }}>
                {splash.third.title}
              </div>
              <Image
                src={splash.third.background}
                alt="background"
                height="384"
                inferSize
                loading="eager"
              />
            </a>

            <a
              href={`/applications/view/${identMap[splash.hero.appId[0]]}/${splash.hero.appId.substring(2)}`}
            >
              <div style={{ color: splash.fourth.color }}>
                {splash.fourth.title}
              </div>
              <Image
                src={splash.fourth.background}
                alt="Background"
                height="384"
                inferSize
                loading="eager"
              />
            </a>
          </div>
        </div>
      </>
    )
  }

  {
    home?.map((apps) => (
      <div class="home_apps">
        <div>
          <span>{apps[0]}</span>
          {/* Re-integrated Lucide ChevronRight */}
          <ChevronRight className="arrow" />
          <button class="all">
            <span>All</span>
            {/* Re-integrated Lucide ChevronRight */}
            <ChevronRight className="arrow" />
          </button>
        </div>
        <div>
          {apps[1].map((app) => (
            <div>{app}</div>
          ))}
        </div>
      </div>
    ))
  }
</div>

<style>
  /* Import the existing CSS file */
  @import "./showcase.css";

  /* Add any additional Astro-specific styles here if needed */
</style>
